# Pi Command Center - Architecture Diagram
# Render with: d2 architecture.d2 architecture.svg

direction: down

title: {
  label: Pi Command Center Architecture
  near: top-center
  shape: text
  style: {
    font-size: 28
    bold: true
  }
}

# External Services
internet: Internet {
  icon: https://icons.terrastruct.com/essentials/globe.svg
  style: {
    fill: "#e74c3c"
  }
}

cloud: Cloud Services {
  telegram: Telegram API {
    icon: https://icons.terrastruct.com/social/telegram.svg
    style.fill: "#0088cc"
  }
  vpn_server: VPN Server {
    label: "VPN Server\n(AWS/DO)"
    icon: https://icons.terrastruct.com/aws/Compute/Amazon-EC2.svg
    style.fill: "#9b59b6"
  }
}

# Raspberry Pi
raspberry: Raspberry Pi {
  style: {
    fill: "#c51a4a"
    stroke: "#8b0a2a"
    stroke-width: 3
  }

  dns_stack: DNS Stack {
    style.fill: "#27ae60"

    pihole: Pi-hole {
      label: "Pi-hole\nDNS + DHCP + Blocking"
      shape: cylinder
    }
    unbound: Unbound {
      label: "Unbound\nRecursive DNS"
      shape: cylinder
    }
    pihole -> unbound: "port 5335"
  }

  security: Security {
    style.fill: "#e67e22"

    ufw: UFW {
      label: "UFW\nFirewall"
      shape: hexagon
    }
    fail2ban: Fail2ban {
      label: "Fail2ban\nIDS/IPS"
      shape: hexagon
    }
  }

  vpn_stack: VPN Stack {
    style.fill: "#9b59b6"

    wireguard: WireGuard {
      label: "WireGuard\nTunnel"
      shape: diamond
    }
    vpn_manager: VPN Manager {
      label: "Split Routing\niptables + fwmark"
    }
    vpn_manager -> wireguard
  }

  bot: Telegram Bot {
    label: "Pi Bot\nPython"
    icon: https://icons.terrastruct.com/dev/python.svg
    style.fill: "#3498db"
  }
}

# LAN Devices
devices: Home Devices {
  style.fill: "#3498db"
  phone: ðŸ“± Phones
  pc: ðŸ’» PCs
  tv: ðŸ“º Smart TV
  iot: ðŸ  IoT
}

# Connections
internet -> cloud.vpn_server
internet -> cloud.telegram

devices -> raspberry.dns_stack.pihole: "DNS/DHCP" {
  style.stroke: "#27ae60"
}

raspberry.dns_stack.unbound -> internet: "Recursive\nQueries" {
  style.stroke-dash: 3
}

raspberry.vpn_stack.wireguard -> cloud.vpn_server: "WireGuard\nTunnel" {
  style.stroke: "#9b59b6"
  style.stroke-width: 2
}

raspberry.bot -> cloud.telegram: "Bot API" {
  style.stroke: "#0088cc"
}

internet -> raspberry.security.ufw: "Filtered" {
  style.stroke: "#e74c3c"
  style.stroke-dash: 5
}
